/*
 * File:   main.c
 * Author: ivan-
 *
 * Created on 30 de mayo de 2018, 05:26 PM
 */
#include "config.h"
const unsigned char sinWaveForm[101] =
	{0x7F,0x86,0x8E,0x96,0x9E,0xA6,0xAD,0xB5,0xBC,0xC3,0xC9,
	 0xCF,0xD5,0xDB,0xE0,0xE5,0xEA,0xEE,0xF1,0xF5,0xF7,0xFA,
	 0xFB,0xFC,0xFD,0xFE,0xFD,0xFC,0xFB,0xFA,0xF7,0xF5,0xF1,
	 0xEE,0xEA,0xE5,0xE0,0xDB,0xD5,0xCF,0xC9,0xC3,0xBC,0xB5,
	 0xAD,0xA6,0x9E,0x96,0x8E,0x86,0x7F,0x77,0x6F,0x67,0x5F,
	 0x57,0x50,0x48,0x41,0x3A,0x34,0x2E,0x28,0x22,0x1D,0x18,
	 0x13,0x0F,0x0C,0x08,0x06,0x03,0x02,0x01,0x00,0x00,0x00,
	 0x01,0x02,0x03,0x06,0x08,0x0C,0x0F,0x13,0x18,0x1D,0x22,
	 0x28,0x2E,0x34,0x3A,0x41,0x48,0x50,0x57,0x5F,0x67,0x6F,
	 0x77};

void main(void) {
    TRISB = 0x00;	//puerto b como salida
    TRISA = 0xFF; //puerto a como entrada
    ADCON1 = 0x0F;	// configura las entradas analogicas
    CMCON = 0x07;		//configura los comparadores
    unsigned char i = 0;	// variable auxiliar
    static bit flag;	// variable de bandera
    for(;;){		// loop infinito
        switch(PORTA & 0x07){	// se enmascara para que solo admita los 3 primeros bits
            case 0x00: LATB--;	// diente de sierra invertido
                break;
            case 0x01:	//triangular
                if(flag) LATB++;
                else LATB--;
                if(LATB>=0xFF) flag = 0;
                if(!flag && !LATB) flag = 1;
                break;
            case 0x02:	//cuadrada
                for(i = 2;i;NOP(),--i); LATB = 0;
                for(i = 5;i;NOP(),--i); LATB = 0xFF;
                break;
            case 0x03:	//senoidal
                LATB = sinWaveForm[i++];
                if(i>99)   i = 0;
                break;
            default:    //diente de sierra
                LATB++;
        }
    }
}
